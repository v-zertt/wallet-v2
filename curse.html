<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy Wallet | –ö—É—Ä—Å–∏ –í–∞–ª—é—Ç</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center; /* –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—ñ */
            padding: 20px;
            padding-bottom: 100px;
            overflow-x: hidden;
        }

        /* –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        .main-container {
            width: 100%;
            max-width: 450px; /* –û–±–º–µ–∂—É—î–º–æ —à–∏—Ä–∏–Ω—É –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .currency-card {
            background: linear-gradient(135deg, #4c51bf, #667eea);
            border-radius: 1.5rem;
            padding: 1.5rem;
            width: 100%;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
            color: white;
            text-align: center;
            margin-bottom: 25px;
            z-index: 1;
        }

        .currency-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 1000 500' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23ffffff' fill-opacity='0.1' d='M0,350 L0,500 L1000,500 L1000,300 C800,400 600,250 400,350 C200,450 100,300 0,350 Z'/%3E%3C/svg%3E");
            background-size: cover;
            background-position: bottom;
            opacity: 0.2;
            z-index: -1;
        }

        .currency-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
            table-layout: fixed; /* –§—ñ–∫—Å–æ–≤–∞–Ω–∞ —à–∏—Ä–∏–Ω–∞ –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ –∞–Ω—ñ–º–∞—Ü—ñ—ó */
        }

        .currency-table th, .currency-table td {
            padding: 0.75rem 0.5rem;
            text-align: center;
            vertical-align: middle;
        }

        .currency-table th:first-child, .currency-table td:first-child { text-align: left; width: 45%; }
        .currency-table td { background-color: rgba(255, 255, 255, 0.1); }
        
        .currency-table tbody td:first-child { border-radius: 0.75rem 0 0 0.75rem; }
        .currency-table tbody td:last-child { border-radius: 0 0.75rem 0.75rem 0; }

        /* –®–∞–ø–∫–∞ —Å–∞–π—Ç—É */
        .header-bar {
            width: 100%;
            max-width: 450px;
            display: flex;
            justify-content: flex-start;
            padding: 1rem 0;
        }

        /* –ë—ñ—á–Ω–µ –º–µ–Ω—é */
        .sidebar {
            position: fixed;
            top: 0; left: -100%; width: 100%; height: 100%;
            background-color: #1f2937;
            z-index: 1500;
            transition: left 0.3s ease-in-out;
            padding: 20px;
            max-width: 400px;
        }
        .sidebar.active { left: 0; }

        .sidebar-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1400;
            display: none;
        }
        .sidebar-overlay.active { display: block; }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –∫—É—Ä—Å–æ—Ä—É */
        .cursor-particle {
            position: fixed;
            pointer-events: none;
            background: #fff;
            border-radius: 50%;
            z-index: 9999;
            animation: fadeOut 0.8s forwards;
        }
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0); }
        }

        /* –î–æ–∫-–ø–∞–Ω–µ–ª—å */
        .bottom-nav-bar {
            position: fixed;
            bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 450px;
            background-color: #2d3748;
            display: flex; justify-content: space-around;
            height: 70px; border-radius: 1.5rem 1.5rem 0 0;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.3);
            z-index: 1000;
        }
        .bottom-nav-item {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            color: #a0aec0; font-size: 0.75rem; transition: 0.2s;
        }
        .bottom-nav-item.active { color: #6366f1; }
    </style>
</head>
<body>

    <header class="header-bar">
        <button id="menuButton" class="text-2xl text-gray-300">
            <i class="fas fa-bars"></i>
        </button>
    </header>

    <div class="main-container">
        <div class="currency-card">
            <h2 class="text-xl font-bold mb-4">–ü–æ–ø—É–ª—è—Ä–Ω—ñ –í–∞–ª—é—Ç–∏</h2>
            <div id="loadingPopular">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            <table class="currency-table hidden" id="popularCurrencyTable">
                <thead>
                    <tr class="text-xs opacity-70">
                        <th>–í–∞–ª—é—Ç–∞</th>
                        <th>–ö—É–ø—ñ–≤–ª—è</th>
                        <th>–ü—Ä–æ–¥–∞–∂</th>
                    </tr>
                </thead>
                <tbody id="popularCurrencyTableBody"></tbody>
            </table>
        </div>

        <div class="currency-card">
            <h2 class="text-xl font-bold mb-4">–°–≤—ñ—Ç–æ–≤—ñ –í–∞–ª—é—Ç–∏</h2>
            <div id="loadingOther">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            <table class="currency-table hidden" id="otherCurrencyTable">
                <thead>
                    <tr class="text-xs opacity-70">
                        <th>–í–∞–ª—é—Ç–∞</th>
                        <th>–ö—É–ø—ñ–≤–ª—è</th>
                        <th>–ü—Ä–æ–¥–∞–∂</th>
                    </tr>
                </thead>
                <tbody id="otherCurrencyTableBody"></tbody>
            </table>
        </div>
    </div>

    <aside id="sidebar" class="sidebar">
        <div class="flex justify-between items-center mb-8 pb-4 border-b border-gray-700">
            <div class="flex items-center">
                <div id="sidebarUserAvatar" class="w-12 h-12 bg-indigo-500 rounded-full flex items-center justify-center mr-3 overflow-hidden"></div>
                <div>
                    <p id="sidebarUsername" class="font-bold">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</p>
                    <p class="text-xs text-gray-400">VIP 0 - Permanent</p>
                </div>
            </div>
            <button id="closeSidebarButton" class="text-2xl">&times;</button>
        </div>
        <nav class="space-y-4">
            <a href="profil.html" class="flex items-center p-3 hover:bg-gray-800 rounded-lg"><i class="fas fa-home mr-3"></i> Home</a>
            <a href="login.html" class="flex items-center p-3 hover:bg-gray-800 rounded-lg"><i class="fas fa-user mr-3"></i> Account</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg"><i class="fas fa-wallet mr-3"></i> Wallet</a>
        </nav>
        <button id="logoutButton" class="mt-auto w-full bg-red-600 p-3 rounded-lg font-bold mt-10">–í–∏–π—Ç–∏</button>
    </aside>
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <nav class="bottom-nav-bar">
        <a href="profil.html" class="bottom-nav-item"><i class="fas fa-home text-xl"></i><span>–ì–æ–ª–æ–≤–Ω–∞</span></a>
        <a href="analytics.html" class="bottom-nav-item"><i class="fas fa-chart-line text-xl"></i><span>–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</span></a>
        <a href="curse.html" class="bottom-nav-item active"><i class="fas fa-coins text-xl"></i><span>–ö—É—Ä—Å–∏</span></a>
        <a href="banka.html" class="bottom-nav-item"><i class="fas fa-jar text-xl"></i><span>–ë–∞–Ω–∫–∞</span></a>
    </nav>

    <script>
        // --- –ê–ù–Ü–ú–ê–¶–Ü–Ø –ß–ò–°–ï–õ ---
        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = (progress * (end - start) + start).toFixed(2);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // --- –î–ê–ù–Ü –¢–ê API ---
        const API_KEY = '4492baa1b3293239a4f6af3f'; 
        const flagMap = { 'USD': 'üá∫üá∏', 'EUR': 'üá™üá∫', 'PLN': 'üáµüá±', 'GBP': 'üá¨üáß', 'HUF': 'üá≠üá∫', 'TRY': 'üáπüá∑', 'CZK': 'üá®üáø', 'DKK': 'üá©üá∞', 'CAD': 'üá®üá¶', 'CHF': 'üá®üá≠' };
        const nameMap = { 'USD': '–î–æ–ª–∞—Ä', 'EUR': '–Ñ–≤—Ä–æ', 'PLN': '–ó–ª–æ—Ç–∏–π', 'GBP': '–§—É–Ω—Ç', 'HUF': '–§–æ—Ä–∏–Ω—Ç', 'TRY': '–õ—ñ—Ä–∞', 'CZK': '–ö—Ä–æ–Ω–∞', 'DKK': '–ö—Ä–æ–Ω–∞', 'CAD': '–î–æ–ª–∞—Ä', 'CHF': '–§—Ä–∞–Ω–∫' };

        async function fetchCurrencyRates() {
            try {
                const response = await fetch(`https://v6.exchangerate-api.com/v6/${API_KEY}/latest/USD`);
                const data = await response.json();
                if (data.result !== 'success') throw new Error();

                const rates = data.conversion_rates;
                const uahBase = rates['UAH'];
                const popular = ['USD', 'EUR'];
                const other = ['PLN', 'GBP', 'TRY', 'CHF', 'CAD', 'CZK'];

                processTable('popularCurrencyTableBody', popular, rates, uahBase);
                processTable('otherCurrencyTableBody', other, rates, uahBase);

                document.getElementById('loadingPopular').classList.add('hidden');
                document.getElementById('popularCurrencyTable').classList.remove('hidden');
                document.getElementById('loadingOther').classList.add('hidden');
                document.getElementById('otherCurrencyTable').classList.remove('hidden');

            } catch (e) {
                console.error("API Error", e);
            }
        }

        function processTable(containerId, list, allRates, uahBase) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            list.forEach((ccy, index) => {
                let rateInUah = ccy === 'USD' ? uahBase : (1 / allRates[ccy]) * uahBase;
                let buy = (rateInUah * 0.995).toFixed(2);
                let sale = (rateInUah * 1.005).toFixed(2);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="flex flex-col">
                            <span class="font-bold">${flagMap[ccy] || ''} ${ccy}</span>
                            <span class="text-[10px] text-gray-300 uppercase">${nameMap[ccy] || ''}</span>
                        </div>
                    </td>
                    <td id="buy-${containerId}-${index}" class="font-mono text-green-300">0.01</td>
                    <td id="sale-${containerId}-${index}" class="font-mono text-red-200">0.01</td>
                `;
                container.appendChild(row);

                // –ó–∞–ø—É—Å–∫ –∞–Ω—ñ–º–∞—Ü—ñ—ó
                setTimeout(() => {
                    animateValue(document.getElementById(`buy-${containerId}-${index}`), 0.01, parseFloat(buy), 1500);
                    animateValue(document.getElementById(`sale-${containerId}-${index}`), 0.01, parseFloat(sale), 1500);
                }, 200);
            });
        }

        // --- –ú–ï–ù–Æ –¢–ê –Ü–ù–®–ï ---
        const menuBtn = document.getElementById('menuButton');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');

        menuBtn.onclick = () => { sidebar.classList.add('active'); overlay.classList.add('active'); };
        document.getElementById('closeSidebarButton').onclick = overlay.onclick = () => {
            sidebar.classList.remove('active'); overlay.classList.remove('active');
        };

        // –ö–æ—Å–º—ñ—á–Ω–∏–π –µ—Ñ–µ–∫—Ç
        document.addEventListener('mousemove', (e) => {
            const p = document.createElement('div');
            p.className = 'cursor-particle';
            p.style.left = e.clientX + 'px';
            p.style.top = e.clientY + 'px';
            const size = Math.random() * 8 + 2;
            p.style.width = p.style.height = size + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 800);
        });

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        document.addEventListener('DOMContentLoaded', () => {
            const user = localStorage.getItem('currentLoggedInUserAccount');
            if (!user) window.location.href = 'login.html';
            
            const registered = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const currUser = registered.find(u => u.email === user || u.mobile === user);
            
            if (currUser) {
                document.getElementById('sidebarUsername').textContent = currUser.username;
                const avatar = document.getElementById('sidebarUserAvatar');
                if (currUser.avatar) avatar.innerHTML = `<img src="${currUser.avatar}" class="w-full h-full object-cover">`;
                else avatar.innerHTML = `<span class="text-xl font-bold">${currUser.username[0].toUpperCase()}</span>`;
            }
            fetchCurrencyRates();
        });

        document.getElementById('logoutButton').onclick = () => {
            localStorage.removeItem('currentLoggedInUserAccount');
            window.location.href = 'login.html';
        };
    </script>
</body>
</html>
